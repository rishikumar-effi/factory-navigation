import { createContext, useReducer, useState, useRef, useCallback } from 'react';

import Box from '@mui/material/Box';
import Stepper from '@mui/material/Stepper';
import Step from '@mui/material/Step';
import StepLabel from '@mui/material/StepLabel';
import StepContent from '@mui/material/StepContent';
import Button from '@mui/material/Button';
import Paper from '@mui/material/Paper';
import Typography from '@mui/material/Typography';

import { StepContextType, NavigationDataType } from './stepRelatedTypes';

export const StepContext = createContext<StepContextType | undefined>(undefined);

type Action =
    | { type: 'UPDATE_STEP_DATA'; step: keyof NavigationDataType; payload: any }
    | { type: 'SET_STEP_VALIDITY'; step: keyof NavigationDataType; valid: boolean }

const defaultValue: NavigationDataType = {
    step1: { data: { image: "" }, valid: false },
    step2: {
        data: {
            walls: []
        }, valid: false
    },
    step3: {
        data: {
            productArray: [
                { productId: 101, productName: "Beer", coOrds: [] },
                { productId: 102, productName: "Frozen Goods", coOrds: [] },
                { productId: 103, productName: "Ice", coOrds: [] },
                { productId: 104, productName: "Household", coOrds: [] },
                { productId: 105, productName: "ATM", coOrds: [] },
                { productId: 106, productName: "Lotto", coOrds: [] },
                { productId: 107, productName: "Seasonal", coOrds: [] },
                { productId: 108, productName: "Medical/Health", coOrds: [] },
                { productId: 109, productName: "Candy", coOrds: [] },
                { productId: 110, productName: "Jerky & Nuts", coOrds: [] },
                { productId: 111, productName: "Chips", coOrds: [] },
                { productId: 112, productName: "Breakfast", coOrds: [] },
                { productId: 113, productName: "Dry Goods", coOrds: [] },
                { productId: 114, productName: "Specials", coOrds: [] },
                { productId: 115, productName: "Roller Grill", coOrds: [] },
                { productId: 116, productName: "POS", coOrds: [] },
                { productId: 117, productName: "Hot Food", coOrds: [] },
                { productId: 118, productName: "Magazines", coOrds: [] },
                { productId: 119, productName: "Automotive", coOrds: [] },
                { productId: 120, productName: "Tobacco Products", coOrds: [] },
                { productId: 121, productName: "Condiments", coOrds: [] },
                { productId: 122, productName: "Coffee Bar", coOrds: [] },
                { productId: 123, productName: "Frozen Beverages", coOrds: [] },
                { productId: 124, productName: "Soft Drinks", coOrds: [] },
            ],
            productWalls: []
        }, valid: false
    },
    step4: { data: { finalArray: [], gridInfo: [], converter: [] }, valid: false }
}

// const defaultValue: NavigationDataType = {
//     step1: {
//         data: {
//             image: ""
//         }, valid: true
//     },
//     step2: {
//         data: {
//             walls: [
//                 {
//                     "latlngs": [
//                         [
//                             791.3210141081562,
//                             -1
//                         ],
//                         [
//                             802.3298527261178,
//                             258
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "fb1fa17a-8c79-46d8-8899-5e500930967d"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             306.9321149178478,
//                             -1
//                         ],
//                         [
//                             791.3210141081562,
//                             8
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "c4a68f35-3790-47ed-a05d-6f4da396a3a6"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             -2.316169895799476,
//                             -1
//                         ],
//                         [
//                             307.93291842857155,
//                             9
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "1251ea65-2495-408a-956f-3855dfeae36c"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             0.8332830988231308,
//                             8
//                         ],
//                         [
//                             11.842121716784675,
//                             447
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "89ac903f-2e15-45cb-80ab-6204447a196c"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             -1.9883375204981917,
//                             542
//                         ],
//                         [
//                             9.020501097463352,
//                             1000
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "f82d8286-52dc-439d-9014-2e6590dbe2db"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             503.4174353950096,
//                             990
//                         ],
//                         [
//                             800.6560780799715,
//                             1001
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "24ef254f-0239-4839-a44e-3d4d3625d194"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 6.997589467828675,
//                                 "lng": 991
//                             },
//                             {
//                                 "lat": 504.41823890573335,
//                                 "lng": 991
//                             },
//                             {
//                                 "lat": 504.41823890573335,
//                                 "lng": 1001.5
//                             },
//                             {
//                                 "lat": 6.997589467828675,
//                                 "lng": 1001.5
//                             }
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "f609800e-83d0-4e75-a019-e868cffe0c71"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             791.5990288185833,
//                             631
//                         ],
//                         [
//                             803.6086709472687,
//                             1000
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "a5384efe-b348-4c90-a6cb-3fa441eccd59"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             738.5564427502231,
//                             257
//                         ],
//                         [
//                             801.6070639258212,
//                             632
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "b26f0f99-0097-47a0-99dc-1893abb0da26"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             677.133796109516,
//                             4
//                         ],
//                         [
//                             792.2261998427505,
//                             52
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "cf7b87b2-d20b-48b2-8304-99db7005cc89"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             552.0333572690438,
//                             6
//                         ],
//                         [
//                             663.1225469593832,
//                             59
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "ed14b820-2b5d-4e37-872d-86e7e6a3d276"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             429.93532896074294,
//                             4
//                         ],
//                         [
//                             534.0188940760158,
//                             61
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "d3ee43db-1fcd-4479-96e6-842836346c7a"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             190.74328989776006,
//                             5
//                         ],
//                         [
//                             417.9256868320576,
//                             40
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "48324936-ffe8-41c1-a9d0-89dc97882fc5"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             70.64686861090672,
//                             11
//                         ],
//                         [
//                             150.7111494688089,
//                             54
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "5b9507d3-45c6-407d-b680-fe2a1910d7e2"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             20.606693074717782,
//                             78
//                         ],
//                         [
//                             74.65008265380186,
//                             135
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "0f17760d-8512-4cde-9998-10e38c3f9c41"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             26.611514139060546,
//                             150
//                         ],
//                         [
//                             60.638833503668934,
//                             322
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "85b2472d-75db-45b8-a5bd-3440bc34f2e5"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             30.294106164035497,
//                             335
//                         ],
//                         [
//                             60.318211485748805,
//                             428
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "51a14cd4-b333-4071-ba29-eaffb2ddcd93"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             143.38490287582238,
//                             151
//                         ],
//                         [
//                             223.94958548908645,
//                             439.5
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "c33a0736-bd8b-4a35-ae8d-18bb17b72aba"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             284.498197887875,
//                             151.5
//                         ],
//                         [
//                             368.0652910333105,
//                             440
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "a77e2486-1472-4ae2-93c3-dd33d2ced28e"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             437.1207332732511,
//                             151.5
//                         ],
//                         [
//                             520.1874246633247,
//                             439
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "d62f1887-d7d9-452c-b3d5-aba8560ea282"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             590.7440721693509,
//                             151
//                         ],
//                         [
//                             676.8131740915958,
//                             439.5
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "38f22710-d8f6-4e0b-bd1a-63f0b5022b77"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             535.5371584928523,
//                             546
//                         ],
//                         [
//                             701.6705412729995,
//                             592
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "5ecb7651-e0d7-4a1b-8a41-5f0cee169909"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             202.26958942183438,
//                             545
//                         ],
//                         [
//                             537.5387655142999,
//                             584
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "d9b5ba01-700a-4717-b977-1e07a903e544"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             179.03576780121512,
//                             545
//                         ],
//                         [
//                             205.05665908003334,
//                             696
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "6c0753b1-b6f3-4a41-8881-7ac89044160f"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             203.05505205858577,
//                             668
//                         ],
//                         [
//                             626.3949370947438,
//                             696
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "a504ec15-1d23-4cb7-b5bc-63a6d86387c9"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             624.3933300732963,
//                             642
//                         ],
//                         [
//                             699.4535933775796,
//                             693
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "c1767901-e963-46f7-b192-b3e91ecab045"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             177.0341607797676,
//                             768
//                         ],
//                         [
//                             441.24628761084494,
//                             843
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "9f45388a-16b1-407e-826c-13abfc1f5092"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             649.4134178413907,
//                             949
//                         ],
//                         [
//                             793.5291233856146,
//                             992
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "10fec7c2-81cf-4d93-a144-a380473de01e"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             482.27923155051974,
//                             935
//                         ],
//                         [
//                             594.3692247515828,
//                             994
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "0f2129de-ca9c-4e69-a178-c70435a1069c"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             284.12013642721183,
//                             935
//                         ],
//                         [
//                             388.2037015424847,
//                             993
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "927815f1-3d95-46ab-859f-d8da319a9ae8"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             48.93131140712404,
//                             935
//                         ],
//                         [
//                             170.02853620470114,
//                             992
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "eb9a6626-339b-46dd-91b0-9a1624aacf5b"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             589.365207197964,
//                             958
//                         ],
//                         [
//                             649.4134178413906,
//                             992
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "66ae337c-7746-4c41-9f25-26b33a1b4d46"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             389.20450505320844,
//                             956
//                         ],
//                         [
//                             481.278428039796,
//                             994
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "7271f519-51d4-44f8-a089-66b6933e411f"
//                 },
//                 {
//                     "latlngs": [
//                         [
//                             169.02773269397736,
//                             956
//                         ],
//                         [
//                             286.12174344865934,
//                             992
//                         ]
//                     ],
//                     "type": "rectangle",
//                     "id": "3279201f-1107-4d19-ba36-b205e16786e9"
//                 }
//             ]
//         }, valid: true
//     },
//     step3: {
//         data: {
//             productArray: [
//                 {
//                     "productId": 101,
//                     "productName": "Beer",
//                     "coOrds": [
//                         {
//                             "lat": 676.3432458441016,
//                             "lng": 4.986687203731776
//                         },
//                         {
//                             "lat": 791.435649577336,
//                             "lng": 4.986687203731776
//                         },
//                         {
//                             "lat": 791.435649577336,
//                             "lng": 54.02292759357306
//                         },
//                         {
//                             "lat": 676.3432458441016,
//                             "lng": 54.02292759357306
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 102,
//                     "productName": "Frozen Goods",
//                     "coOrds": [
//                         {
//                             "lat": 551.2428070036293,
//                             "lng": 5.987426803524457
//                         },
//                         {
//                             "lat": 662.3319966939687,
//                             "lng": 5.987426803524457
//                         },
//                         {
//                             "lat": 662.3319966939687,
//                             "lng": 60.027365192329114
//                         },
//                         {
//                             "lat": 551.2428070036293,
//                             "lng": 60.027365192329114
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 103,
//                     "productName": "Ice",
//                     "coOrds": [
//                         {
//                             "lat": 432.1471892274998,
//                             "lng": 5.987426803524443
//                         },
//                         {
//                             "lat": 532.2275402998775,
//                             "lng": 5.987426803524443
//                         },
//                         {
//                             "lat": 532.2275402998775,
//                             "lng": 60.027365192329114
//                         },
//                         {
//                             "lat": 432.1471892274998,
//                             "lng": 60.027365192329114
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 104,
//                     "productName": "Household",
//                     "coOrds": [
//                         {
//                             "lat": 195.07969432670245,
//                             "lng": 5.103543970975096
//                         },
//                         {
//                             "lat": 419.25968072882864,
//                             "lng": 5.103543970975096
//                         },
//                         {
//                             "lat": 419.25968072882864,
//                             "lng": 39.12869036392618
//                         },
//                         {
//                             "lat": 195.07969432670245,
//                             "lng": 39.12869036392618
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 105,
//                     "productName": "ATM",
//                     "coOrds": [
//                         {
//                             "lat": 71.98086250767778,
//                             "lng": 10.107241969938485
//                         },
//                         {
//                             "lat": 150.04353634413246,
//                             "lng": 10.107241969938485
//                         },
//                         {
//                             "lat": 150.04353634413246,
//                             "lng": 52.13830516123102
//                         },
//                         {
//                             "lat": 71.98086250767778,
//                             "lng": 52.13830516123102
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 106,
//                     "productName": "Lotto",
//                     "coOrds": [
//                         {
//                             "lat": 21.46110311242103,
//                             "lng": 77.56952238051184
//                         },
//                         {
//                             "lat": 75.50449269150499,
//                             "lng": 77.56952238051184
//                         },
//                         {
//                             "lat": 75.50449269150499,
//                             "lng": 133.61093996890187
//                         },
//                         {
//                             "lat": 21.46110311242103,
//                             "lng": 133.61093996890187
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 107,
//                     "productName": "Seasonal",
//                     "coOrds": [
//                         {
//                             "lat": 29.46753119821119,
//                             "lng": 151.12388296527376
//                         },
//                         {
//                             "lat": 60.49244003064837,
//                             "lng": 151.12388296527376
//                         },
//                         {
//                             "lat": 60.49244003064837,
//                             "lng": 321.2496149300292
//                         },
//                         {
//                             "lat": 29.46753119821119,
//                             "lng": 321.2496149300292
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 108,
//                     "productName": "Medical/Health",
//                     "coOrds": [
//                         {
//                             "lat": 183.11263826637736,
//                             "lng": 151.44893707415622
//                         },
//                         {
//                             "lat": 225.14638571677602,
//                             "lng": 151.44893707415622
//                         },
//                         {
//                             "lat": 225.14638571677602,
//                             "lng": 439.6619418144478
//                         },
//                         {
//                             "lat": 183.11263826637736,
//                             "lng": 439.6619418144478
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 109,
//                     "productName": "Candy",
//                     "coOrds": [
//                         {
//                             "lat": 284.1937928494789,
//                             "lng": 151.44893707415628
//                         },
//                         {
//                             "lat": 326.22754029987755,
//                             "lng": 151.44893707415628
//                         },
//                         {
//                             "lat": 326.22754029987755,
//                             "lng": 439.6619418144478
//                         },
//                         {
//                             "lat": 284.1937928494789,
//                             "lng": 439.6619418144478
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 110,
//                     "productName": "Jerky & Nuts",
//                     "coOrds": [
//                         {
//                             "lat": 326.22754029987755,
//                             "lng": 150.4481974743636
//                         },
//                         {
//                             "lat": 368.2612877502762,
//                             "lng": 150.4481974743636
//                         },
//                         {
//                             "lat": 368.2612877502762,
//                             "lng": 438.6612022146552
//                         },
//                         {
//                             "lat": 326.22754029987755,
//                             "lng": 438.6612022146552
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 111,
//                     "productName": "Chips",
//                     "coOrds": [
//                         {
//                             "lat": 436.3159264794931,
//                             "lng": 150.4481974743636
//                         },
//                         {
//                             "lat": 479.3504774406156,
//                             "lng": 150.4481974743636
//                         },
//                         {
//                             "lat": 479.3504774406156,
//                             "lng": 438.6612022146553
//                         },
//                         {
//                             "lat": 436.3159264794931,
//                             "lng": 438.6612022146553
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 112,
//                     "productName": "Breakfast",
//                     "coOrds": [
//                         {
//                             "lat": 479.3504774406156,
//                             "lng": 151.44893707415633
//                         },
//                         {
//                             "lat": 521.3842248910142,
//                             "lng": 151.44893707415633
//                         },
//                         {
//                             "lat": 521.3842248910142,
//                             "lng": 437.6604626148626
//                         },
//                         {
//                             "lat": 479.3504774406156,
//                             "lng": 437.6604626148626
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 113,
//                     "productName": "Dry Goods",
//                     "coOrds": [
//                         {
//                             "lat": 590.4396671309548,
//                             "lng": 149.447457874571
//                         },
//                         {
//                             "lat": 633.4742180920773,
//                             "lng": 149.447457874571
//                         },
//                         {
//                             "lat": 633.4742180920773,
//                             "lng": 437.6604626148626
//                         },
//                         {
//                             "lat": 590.4396671309548,
//                             "lng": 437.6604626148626
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 114,
//                     "productName": "Specials",
//                     "coOrds": [
//                         {
//                             "lat": 632.4734145813536,
//                             "lng": 149.447457874571
//                         },
//                         {
//                             "lat": 676.5087690531998,
//                             "lng": 149.447457874571
//                         },
//                         {
//                             "lat": 676.5087690531998,
//                             "lng": 439.661941814448
//                         },
//                         {
//                             "lat": 632.4734145813536,
//                             "lng": 439.661941814448
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 115,
//                     "productName": "Roller Grill",
//                     "coOrds": [
//                         {
//                             "lat": 535.3954740411472,
//                             "lng": 545.7403393924719
//                         },
//                         {
//                             "lat": 701.5288568212942,
//                             "lng": 545.7403393924719
//                         },
//                         {
//                             "lat": 701.5288568212942,
//                             "lng": 590.7736213831425
//                         },
//                         {
//                             "lat": 535.3954740411472,
//                             "lng": 590.7736213831425
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 116,
//                     "productName": "POS",
//                     "coOrds": [
//                         {
//                             "lat": 203.12870848085288,
//                             "lng": 548.7425581918501
//                         },
//                         {
//                             "lat": 537.3970810625947,
//                             "lng": 548.7425581918501
//                         },
//                         {
//                             "lat": 537.3970810625947,
//                             "lng": 584.7691837843865
//                         },
//                         {
//                             "lat": 203.12870848085288,
//                             "lng": 584.7691837843865
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 117,
//                     "productName": "Hot Food",
//                     "coOrds": [
//                         {
//                             "lat": 649.3186653845021,
//                             "lng": 948.5894915749142
//                         },
//                         {
//                             "lat": 799.9395937484308,
//                             "lng": 948.5894915749142
//                         },
//                         {
//                             "lat": 799.9395937484308,
//                             "lng": 991.1209245661031
//                         },
//                         {
//                             "lat": 649.3186653845021,
//                             "lng": 991.1209245661031
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 118,
//                     "productName": "Magazines",
//                     "coOrds": [
//                         {
//                             "lat": 177.99758946782867,
//                             "lng": 546.7410789922646
//                         },
//                         {
//                             "lat": 203.12870848085288,
//                             "lng": 546.7410789922646
//                         },
//                         {
//                             "lat": 203.12870848085288,
//                             "lng": 695.0007395997927
//                         },
//                         {
//                             "lat": 177.99758946782867,
//                             "lng": 695.0007395997927
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 119,
//                     "productName": "Automotive",
//                     "coOrds": [
//                         {
//                             "lat": 139.1953998709264,
//                             "lng": 149.49405266150973
//                         },
//                         {
//                             "lat": 183.23075434277268,
//                             "lng": 149.49405266150973
//                         },
//                         {
//                             "lat": 183.23075434277268,
//                             "lng": 439.70853660138664
//                         },
//                         {
//                             "lat": 139.1953998709264,
//                             "lng": 439.70853660138664
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 120,
//                     "productName": "Tobacco Products",
//                     "coOrds": [
//                         {
//                             "lat": 204.07165921946466,
//                             "lng": 667.2115255407061
//                         },
//                         {
//                             "lat": 625.409937234175,
//                             "lng": 667.2115255407061
//                         },
//                         {
//                             "lat": 625.409937234175,
//                             "lng": 694.2314947351085
//                         },
//                         {
//                             "lat": 204.07165921946466,
//                             "lng": 694.2314947351085
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 121,
//                     "productName": "Condiments",
//                     "coOrds": [
//                         {
//                             "lat": 626.4107407448989,
//                             "lng": 642.1930355458893
//                         },
//                         {
//                             "lat": 700.4702005384584,
//                             "lng": 642.1930355458893
//                         },
//                         {
//                             "lat": 700.4702005384584,
//                             "lng": 694.2314947351085
//                         },
//                         {
//                             "lat": 626.4107407448989,
//                             "lng": 694.2314947351085
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 122,
//                     "productName": "Coffee Bar",
//                     "coOrds": [
//                         {
//                             "lat": 176.06844517656958,
//                             "lng": 770.3039755147911
//                         },
//                         {
//                             "lat": 441.2813755183706,
//                             "lng": 770.3039755147911
//                         },
//                         {
//                             "lat": 441.2813755183706,
//                             "lng": 843.3579662996567
//                         },
//                         {
//                             "lat": 176.06844517656958,
//                             "lng": 843.3579662996567
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 123,
//                     "productName": "Frozen Beverages",
//                     "coOrds": [
//                         {
//                             "lat": 47.814535787855846,
//                             "lng": 935.1878583473404
//                         },
//                         {
//                             "lat": 170.9133676068805,
//                             "lng": 935.1878583473404
//                         },
//                         {
//                             "lat": 170.9133676068805,
//                             "lng": 992.2300155355233
//                         },
//                         {
//                             "lat": 47.814535787855846,
//                             "lng": 992.2300155355233
//                         }
//                     ]
//                 },
//                 {
//                     "productId": 124,
//                     "productName": "Soft Drinks",
//                     "coOrds": [
//                         {
//                             "lat": 284.0253839703232,
//                             "lng": 936.5806163774021
//                         },
//                         {
//                             "lat": 389.1097525963199,
//                             "lng": 936.5806163774021
//                         },
//                         {
//                             "lat": 389.1097525963199,
//                             "lng": 993.1224037656884
//                         },
//                         {
//                             "lat": 284.0253839703232,
//                             "lng": 993.1224037656884
//                         }
//                     ]
//                 }
//             ],
//             productWalls: [
//                 {
//                     "id": "7f72f85c-ef79-450a-8e2d-d9511d56033e",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 677.2918211577797,
//                                 "lng": 5.957771502909964
//                             },
//                             {
//                                 "lat": 791.3834213802904,
//                                 "lng": 5.957771502909964
//                             },
//                             {
//                                 "lat": 791.3834213802904,
//                                 "lng": 52.97649545916687
//                             },
//                             {
//                                 "lat": 677.2918211577797,
//                                 "lng": 52.97649545916687
//                             }
//                         ]
//                     ],
//                     "productId": "101"
//                 },
//                 {
//                     "id": "4c32c3fa-b00f-4d76-82cb-3b92792a2a09",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 548.1881682744124,
//                                 "lng": 5.957771502909964
//                             },
//                             {
//                                 "lat": 663.2805720076469,
//                                 "lng": 5.957771502909964
//                             },
//                             {
//                                 "lat": 663.2805720076469,
//                                 "lng": 58.97888575145498
//                             },
//                             {
//                                 "lat": 548.1881682744124,
//                                 "lng": 58.97888575145498
//                             }
//                         ]
//                     ],
//                     "productId": "102"
//                 },
//                 {
//                     "id": "9cbfa89d-5d27-41c8-b5c3-37f2376d446f",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 433.095764541178,
//                                 "lng": 5.957771502909964
//                             },
//                             {
//                                 "lat": 533.1761156135558,
//                                 "lng": 5.957771502909964
//                             },
//                             {
//                                 "lat": 533.1761156135558,
//                                 "lng": 60.97968251555102
//                             },
//                             {
//                                 "lat": 433.095764541178,
//                                 "lng": 60.97968251555102
//                             }
//                         ]
//                     ],
//                     "productId": "103"
//                 },
//                 {
//                     "id": "80969684-3615-457a-b755-49da26185367",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 193.90372547819516,
//                                 "lng": 3.9569747388139263
//                             },
//                             {
//                                 "lat": 417.0829083695976,
//                                 "lng": 3.9569747388139263
//                             },
//                             {
//                                 "lat": 417.0829083695976,
//                                 "lng": 40.971714874590646
//                             },
//                             {
//                                 "lat": 193.90372547819516,
//                                 "lng": 40.971714874590646
//                             }
//                         ]
//                     ],
//                     "productId": "104"
//                 },
//                 {
//                     "id": "ea3721d1-287b-4da7-a495-97b72addcda0",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 69.87271693280547,
//                                 "lng": 11.466535907966374
//                             },
//                             {
//                                 "lat": 150.43739954606957,
//                                 "lng": 11.466535907966374
//                             },
//                             {
//                                 "lat": 150.43739954606957,
//                                 "lng": 52.98306876295918
//                             },
//                             {
//                                 "lat": 69.87271693280547,
//                                 "lng": 52.98306876295918
//                             }
//                         ]
//                     ],
//                     "productId": "105"
//                 },
//                 {
//                     "id": "83f1ba3c-05d8-4d78-89d8-0fbf3b9bef0f",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 20.833344907340347,
//                                 "lng": 77.49282912313564
//                             },
//                             {
//                                 "lat": 74.87673448642431,
//                                 "lng": 77.49282912313564
//                             },
//                             {
//                                 "lat": 74.87673448642431,
//                                 "lng": 134.51553689987273
//                             },
//                             {
//                                 "lat": 20.833344907340347,
//                                 "lng": 134.51553689987273
//                             }
//                         ]
//                     ],
//                     "productId": "106"
//                 },
//                 {
//                     "id": "3cd84fb4-92d9-4d42-b14d-f6530558418e",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 29.840576503854322,
//                                 "lng": 150.52191101264106
//                             },
//                             {
//                                 "lat": 60.365083580929536,
//                                 "lng": 150.52191101264106
//                             },
//                             {
//                                 "lat": 60.365083580929536,
//                                 "lng": 322.5904327249004
//                             },
//                             {
//                                 "lat": 29.840576503854322,
//                                 "lng": 322.5904327249004
//                             }
//                         ]
//                     ],
//                     "productId": "107"
//                 },
//                 {
//                     "id": "bf3ee655-3e9d-4e4d-a5ae-5bc24b8cead0",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 181.86227129339636,
//                                 "lng": 151.02330534980914
//                             },
//                             {
//                                 "lat": 223.89601874379503,
//                                 "lng": 151.02330534980914
//                             },
//                             {
//                                 "lat": 223.89601874379503,
//                                 "lng": 439.6382385706627
//                             },
//                             {
//                                 "lat": 181.86227129339636,
//                                 "lng": 439.6382385706627
//                             }
//                         ]
//                     ],
//                     "productId": "108"
//                 },
//                 {
//                     "id": "e47b0b50-fe07-4eba-940c-0e82c99cc12f",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 283.9442293872217,
//                                 "lng": 151.02330534980914
//                             },
//                             {
//                                 "lat": 325.47757508225845,
//                                 "lng": 151.02330534980914
//                             },
//                             {
//                                 "lat": 325.47757508225845,
//                                 "lng": 439.6382385706627
//                             },
//                             {
//                                 "lat": 283.9442293872217,
//                                 "lng": 439.6382385706627
//                             }
//                         ]
//                     ],
//                     "productId": "109"
//                 },
//                 {
//                     "id": "513705a3-a6ba-4c15-90a2-63c734443031",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 325.97797683762036,
//                                 "lng": 150.52310615878514
//                             },
//                             {
//                                 "lat": 367.5113225326571,
//                                 "lng": 150.52310615878514
//                             },
//                             {
//                                 "lat": 367.5113225326571,
//                                 "lng": 440.1384377616867
//                             },
//                             {
//                                 "lat": 325.97797683762036,
//                                 "lng": 440.1384377616867
//                             }
//                         ]
//                     ],
//                     "productId": "110"
//                 },
//                 {
//                     "id": "6ab2cc20-a098-46d2-9cfa-4b6fafd8bd6e",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 436.5667647725978,
//                                 "lng": 150.02290696776112
//                             },
//                             {
//                                 "lat": 479.10091397835834,
//                                 "lng": 150.02290696776112
//                             },
//                             {
//                                 "lat": 479.10091397835834,
//                                 "lng": 440.1384377616867
//                             },
//                             {
//                                 "lat": 436.5667647725978,
//                                 "lng": 440.1384377616867
//                             }
//                         ]
//                     ],
//                     "productId": "111"
//                 },
//                 {
//                     "id": "4ffe361f-9dac-4653-b4aa-164ae5fc6b04",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 477.5997087122727,
//                                 "lng": 151.02330534980914
//                             },
//                             {
//                                 "lat": 520.1338579180333,
//                                 "lng": 151.02330534980914
//                             },
//                             {
//                                 "lat": 520.1338579180333,
//                                 "lng": 440.1384377616867
//                             },
//                             {
//                                 "lat": 477.5997087122727,
//                                 "lng": 440.1384377616867
//                             }
//                         ]
//                     ],
//                     "productId": "112"
//                 },
//                 {
//                     "id": "3422ccd8-4d13-4109-8631-462b81b1216c",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 592.6334561626713,
//                                 "lng": 150.02111424854502
//                             },
//                             {
//                                 "lat": 633.6664001023462,
//                                 "lng": 150.02111424854502
//                             },
//                             {
//                                 "lat": 633.6664001023462,
//                                 "lng": 439.13624666042256
//                             },
//                             {
//                                 "lat": 592.6334561626713,
//                                 "lng": 439.13624666042256
//                             }
//                         ]
//                     ],
//                     "productId": "113"
//                 },
//                 {
//                     "id": "14c86766-cd26-4a87-a2c9-e85afb703431",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 633.6664001023462,
//                                 "lng": 151.02151263059304
//                             },
//                             {
//                                 "lat": 675.7001475527449,
//                                 "lng": 151.02151263059304
//                             },
//                             {
//                                 "lat": 675.7001475527449,
//                                 "lng": 438.6360474693986
//                             },
//                             {
//                                 "lat": 633.6664001023462,
//                                 "lng": 438.6360474693986
//                             }
//                         ]
//                     ],
//                     "productId": "114"
//                 },
//                 {
//                     "id": "f34e78ca-a0b6-4d20-87a4-068debe15817",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 536.5884595621397,
//                                 "lng": 547.1324620309664
//                             },
//                             {
//                                 "lat": 701.2206370762012,
//                                 "lng": 547.1324620309664
//                             },
//                             {
//                                 "lat": 701.2206370762012,
//                                 "lng": 590.6497916500552
//                             },
//                             {
//                                 "lat": 536.5884595621397,
//                                 "lng": 590.6497916500552
//                             }
//                         ]
//                     ],
//                     "productId": "115"
//                 },
//                 {
//                     "id": "ecd7aea7-c834-4ad1-b955-67213e16244b",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 204.99799122319052,
//                                 "lng": 547.2944043334862
//                             },
//                             {
//                                 "lat": 537.0515714513703,
//                                 "lng": 547.2944043334862
//                             },
//                             {
//                                 "lat": 537.0515714513703,
//                                 "lng": 585.000398382048
//                             },
//                             {
//                                 "lat": 204.99799122319052,
//                                 "lng": 585.000398382048
//                             }
//                         ]
//                     ],
//                     "productId": "116"
//                 },
//                 {
//                     "id": "ac4ab3ad-8f98-4600-bf43-133162d6a301",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 177.4648206460622,
//                                 "lng": 546.0102378792332
//                             },
//                             {
//                                 "lat": 204.48651543560413,
//                                 "lng": 546.0102378792332
//                             },
//                             {
//                                 "lat": 204.48651543560413,
//                                 "lng": 696.069995186436
//                             },
//                             {
//                                 "lat": 177.4648206460622,
//                                 "lng": 696.069995186436
//                             }
//                         ]
//                     ],
//                     "productId": "118"
//                 },
//                 {
//                     "id": "a1547d86-a43d-4701-b4eb-2d63ee1fcbc9",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 145.10781720203477,
//                                 "lng": 150.98446310012724
//                             },
//                             {
//                                 "lat": 183.1383506095383,
//                                 "lng": 150.98446310012724
//                             },
//                             {
//                                 "lat": 183.1383506095383,
//                                 "lng": 440.09959551200484
//                             },
//                             {
//                                 "lat": 145.10781720203477,
//                                 "lng": 440.09959551200484
//                             }
//                         ]
//                     ],
//                     "productId": "119"
//                 },
//                 {
//                     "id": "53534c7a-f487-442c-a9cd-02c60228ca4d",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 204.15522433473757,
//                                 "lng": 667.1900282369053
//                             },
//                             {
//                                 "lat": 624.4926988387242,
//                                 "lng": 667.1900282369053
//                             },
//                             {
//                                 "lat": 624.4926988387242,
//                                 "lng": 694.2007845522018
//                             },
//                             {
//                                 "lat": 204.15522433473757,
//                                 "lng": 694.2007845522018
//                             }
//                         ]
//                     ],
//                     "productId": "120"
//                 },
//                 {
//                     "id": "83ccc93e-161e-4558-a797-09b6634f04db",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 624.2085844153445,
//                                 "lng": 643.1113477824215
//                             },
//                             {
//                                 "lat": 700.2696512303517,
//                                 "lng": 643.1113477824215
//                             },
//                             {
//                                 "lat": 700.2696512303517,
//                                 "lng": 696.1324620309665
//                             },
//                             {
//                                 "lat": 624.2085844153445,
//                                 "lng": 696.1324620309665
//                             }
//                         ]
//                     ],
//                     "productId": "121"
//                 },
//                 {
//                     "id": "37dd9c42-d85b-4786-b499-57c9a84e4669",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 179.12629794868144,
//                                 "lng": 768.3422101792485
//                             },
//                             {
//                                 "lat": 440.3360142475874,
//                                 "lng": 768.3422101792485
//                             },
//                             {
//                                 "lat": 440.3360142475874,
//                                 "lng": 844.372487214898
//                             },
//                             {
//                                 "lat": 179.12629794868144,
//                                 "lng": 844.372487214898
//                             }
//                         ]
//                     ],
//                     "productId": "122"
//                 },
//                 {
//                     "id": "d8daf826-fa01-40e4-b7bf-56021a6d4142",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 46.99485056281969,
//                                 "lng": 935.6958047766016
//                             },
//                             {
//                                 "lat": 171.09448589256806,
//                                 "lng": 935.6958047766016
//                             },
//                             {
//                                 "lat": 171.09448589256806,
//                                 "lng": 992.7185125533387
//                             },
//                             {
//                                 "lat": 46.99485056281969,
//                                 "lng": 992.7185125533387
//                             }
//                         ]
//                     ],
//                     "productId": "123"
//                 },
//                 {
//                     "id": "e1e44fc0-b4c2-4490-93c5-ac8ebc70476a",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 285.42359691647926,
//                                 "lng": 934.347389145873
//                             },
//                             {
//                                 "lat": 389.50716203175216,
//                                 "lng": 934.347389145873
//                             },
//                             {
//                                 "lat": 389.50716203175216,
//                                 "lng": 995.3716904508021
//                             },
//                             {
//                                 "lat": 285.42359691647926,
//                                 "lng": 995.3716904508021
//                             }
//                         ]
//                     ],
//                     "productId": "124"
//                 },
//                 {
//                     "id": "bbc7e0d6-988f-4a53-a84c-ae65bc10bcb0",
//                     "type": "rectangle",
//                     "latlngs": [
//                         [
//                             {
//                                 "lat": 651.7176818413819,
//                                 "lng": 949.3533648765933
//                             },
//                             {
//                                 "lat": 795.8333873856059,
//                                 "lng": 949.3533648765933
//                             },
//                             {
//                                 "lat": 795.8333873856059,
//                                 "lng": 989.3693001585141
//                             },
//                             {
//                                 "lat": 651.7176818413819,
//                                 "lng": 989.3693001585141
//                             }
//                         ]
//                     ],
//                     "productId": "117"
//                 }
//             ]
//         }, valid: false
//     },
//     step4: { data: { finalArray: [], gridInfo: [], converter: [] }, valid: false }
// }

const steps = [
    {
        label: 'Upload your floor map',
        description: 'Upload the image of your floor map which you need to navigate',
    },
    {
        label: 'Mark Obstacles',
        description: 'Draw the obstacles on the map using the tools provided in the toolbar',
    },
    {
        label: 'Mark the Product',
        description: 'Select the product in the dropdown and draw the product, using the tools provided in the toolbar',
    },
    {
        label: 'Map and Product view',
        description: 'Click to navigate to the product',
    },
];

const reducer = (state: NavigationDataType, action: Action): NavigationDataType => {
    switch (action.type) {
        case 'UPDATE_STEP_DATA':
            return {
                ...state,
                [action.step]: {
                    ...state[action.step],
                    data: {
                        ...state[action.step].data,
                        ...action.payload,
                    }
                }
            };
        case "SET_STEP_VALIDITY":
            return {
                ...state,
                [action.step]: {
                    ...state[action.step],
                    valid: action.valid,
                }
            }
        default:
            return state;
    }
}

export const StepProvider = ({ children }) => {
    const initialRef = useRef(defaultValue);

    const [activeStep, setActiveStep] = useState<number>(0);

    const [isNextActive, setIsNextActive] = useState<boolean>(false);

    const [navigationData, dispatch] = useReducer(reducer, initialRef.current, (init) => init);

    const continueHandlerRef = useRef<(() => void | Promise<void>)>(null);

    const setNxtBtnState = (state: boolean) => setIsNextActive(state);

    const setContinueHandler = useCallback((handler: () => void | Promise<void>) => {
        continueHandlerRef.current = handler;
    }, [])

    const handleNext = useCallback(async () => {
        if (continueHandlerRef.current) {
            await continueHandlerRef.current();
        }

        setActiveStep((prevActiveStep) => prevActiveStep + 1);
    }, []);

    const handleBack = useCallback(() => {
        setActiveStep((prevActiveStep) => prevActiveStep - 1);
    }, []);

    const handleReset = useCallback(() => {
        setActiveStep(0);
    }, []);

    const updateStepData = useCallback((step: keyof NavigationDataType, data: any) => {
        dispatch({ type: 'UPDATE_STEP_DATA', step, payload: data });
    }, []);

    const setStepValidity = useCallback((step: keyof NavigationDataType, valid: boolean) => {
        dispatch({ type: 'SET_STEP_VALIDITY', step, valid });
    }, []);

    const values = {
        activeStep, toNext: handleNext, toPrevious: handleBack, reset: handleReset, setNxtBtnState, updateStepData, setStepValidity, navigationData, setContinueHandler
    }

    return (
        <StepContext.Provider value={values}>
            <Box component="main" sx={{ m: 2 }}>
                <Box component="section" sx={{ display: 'flex', padding: '2rem', alignItems: 'center', gap: 4 }}>
                    <Box component="aside" sx={{ maxWidth: 300 }}>
                        <Typography variant="h1" style={{ fontSize: '32px', textAlign: 'center', letterSpacing: '1px', marginBottom: '1em' }}>Floor Navigation</Typography>
                        <Stepper activeStep={activeStep} orientation="vertical">
                            {steps.map((step, index) => (
                                <Step sx={{ '& .MuiStepIcon-root.Mui-completed': { color: '#88dc3e' }, '& .MuiStepLabel-label': { color: '#cecece', fontSize: '16px' }, '& .MuiStepLabel-label.Mui-completed': { color: '#cecece' }, '& .MuiStepLabel-label.Mui-active': { color: '#fff' }, '& .MuiTypography-root': { textAlign: 'left', color: '#bdbdbd', fontSize: '14px' } }} key={step.label}>
                                    <StepLabel
                                        optional={
                                            index === steps.length - 1 ? (
                                                <Typography variant="caption">Last step</Typography>
                                            ) : null
                                        }
                                    >
                                        {step.label}
                                    </StepLabel>
                                    <StepContent>
                                        <Typography>{step.description}</Typography>
                                        <Box sx={{ mb: 2 }}>
                                            <Button
                                                disabled={!isNextActive}
                                                variant="contained"
                                                onClick={handleNext}
                                                sx={{ mt: 1, mr: 1, '&.Mui-disabled': { background: '#2d68a3', opacity: '.8', color: '#fff', cursor: 'not-allowed' } }}
                                            >
                                                {index === steps.length - 1 ? 'Finish' : 'Continue'}
                                            </Button>
                                            {index !== 0 && <Button
                                                onClick={handleBack}
                                                sx={{ mt: 1, mr: 1 }}
                                            >
                                                Back
                                            </Button>}

                                        </Box>
                                    </StepContent>
                                </Step>
                            ))}
                        </Stepper>
                        {activeStep === steps.length && (
                            <Paper square elevation={0} sx={{ p: 3 }}>
                                <Typography>All steps completed - you&apos;re finished</Typography>
                                <Button onClick={handleReset} sx={{ mt: 1, mr: 1 }}>
                                    Reset
                                </Button>
                            </Paper>
                        )}
                    </Box>
                    <Box sx={{ flex: 1 }}>
                        {children}
                    </Box>
                </Box>
            </Box>
        </StepContext.Provider>
    );
}